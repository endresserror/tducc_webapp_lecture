# Space Invaders Web App - Webアプリ開発講座

## はじめに

某有名なシューティングゲームをFlaskで再現したものです。このプログラムはあくまでオンラインゲームってどうやって作るのかなってのサーバ側の実装を通して知るためのものです。何かの言語を出来るから偉い、何かの技術を触っているから自慢するのでなく、あくまで僕はプログラミングは楽しいからやるのスタンスなのであくまでもやってみたかったけど作り方がわからないって人に機会を提供したいだけでいつも作ってるプログラムを公開しています。ですので遠慮なく使ってください

*   **Webアプリケーションの基本構造**：サーバーサイド（Python/Flask）とクライアントサイド（HTML/CSS/JavaScript）の連携。
*   **フロントエンド技術**：HTMLで構造を作り、CSSで見た目を整え、JavaScriptで動的な処理（ゲームロジック）を実装する方法。
*   **簡単なサーバーサイド処理**：Flaskを使ったルーティングや静的ファイルの配信。
*   **JavaScriptによるゲーム開発**：クラスベースのオブジェクト指向プログラミング、イベント処理、DOM操作の基礎。

## プロジェクト構造

プロジェクトのフォルダ構成は以下のようになっています。

```
space-invaders-webapp
├── static/                  # 静的ファイル（CSS、JavaScript、画像、音声など）
│   ├── css/
│   │   └── style.css      # ゲームの見た目を定義するCSSファイル
│   ├── js/
│   │   └── game.js        # ゲームの主要なロジックを記述したJavaScriptファイル
│   └── assets/            # ゲーム内で使用する画像や音声ファイル
│       ├── sounds/        # 効果音ファイル (例: shoot.wav, explosion.wav)
│       └── sprites/       # 画像ファイル (例: player.png, enemy.png)
├── templates/               # HTMLテンプレートファイル
│   ├── index.html         # スタート画面や説明用のHTML（今回は主にgame.htmlを使用）
│   └── game.html          # ゲーム画面本体のHTMLファイル
├── app.py                   # Flaskアプリケーションのメインファイル（サーバーサイド処理）
├── game/                    # (オプション) より複雑なサーバーサイドロジック用
│   ├── __init__.py
│   ├── game_logic.py
│   └── models.py
├── requirements.txt         # プロジェクトに必要なPythonライブラリリスト
└── README.md                # このファイル (プロジェクトの説明書)
```

## 主要ファイルの説明

### 1. `static/js/game.js`

このファイルがゲームの心臓部です！プレイヤーの操作、敵の動き、弾の発射、衝突判定など、ゲームのほぼ全てのロジックがJavaScriptで書かれています。
最近の更新で、コードはより整理され、パフォーマンスも向上しました。具体的には以下のクラスが導入されています：

*   `GameStateManager`: ゲームの状態（プレイ中、ポーズ、ゲームオーバーなど）を管理します。
*   `ObjectPool`: 弾などのオブジェクトを効率的に再利用し、パフォーマンスを向上させます。
*   `PerformanceMonitor`: ゲームのフレームレートなどを監視します（開発用）。
*   `Player`, `Enemy`, `UFO`, `Shield`, `Bullet`などのクラス: ゲーム内の各要素をオブジェクトとして表現しています。

**改造ポイント*
*   プレイヤーの体力(`Player`クラスの`health`)や移動速度(`Player`クラスの`speed`)を変えましょう。
*   敵の出現パターン(`Enemy`の生成ロジック)や動きの速さ(`Enemy`クラスの`speed`)を調整しよう。
*   新しい種類の弾やアイテムを追加しよう。

### 2. `static/css/style.css`

ゲームの見た目（背景色、文字のスタイル、キャンバスの配置など）を定義するCSSファイルです。ここを編集することで、ゲームのデザインを自由に変更できます。

### 3. `templates/game.html`

実際にブラウザに表示されるゲーム画面の骨組みとなるHTMLファイルです。ゲームを描画するための`<canvas>`要素や、`game.js`、`style.css`を読み込む記述が含まれています。

### 4. `app.py`

PythonのFlaskフレームワークを使って作られた、このWebアプリケーションのサーバーサイドの処理を担当するファイルです。主な役割は以下の通りです。

*   特定のURL（例：`/game`）にアクセスがあったときに、どのHTMLファイル（例：`game.html`）を表示するかを決定します（ルーティング）。
*   `static`フォルダ内のCSS、JavaScript、画像ファイルなどをブラウザに提供します。

## プロジェクトの入手方法 (初学者向け)

このプロジェクトを手元で動かしたり、改造したりするためには、まずプロジェクトのファイル一式を入手する必要があるので。主な方法として、Gitを使った方法と、ZIPファイルをダウンロードする方法を紹介します。

### 1. Gitを使ってフォーク・クローンする (推奨)

Gitはバージョン管理システムで、ソフトウェア開発で広く使われています。GitHubはGitリポジトリをホスティングするサービスです。

*   **GitHubアカウントの作成**: もし持っていなければ、[GitHub](https://github.com/)でアカウントを作成してください。
*   **リポジトリのフォーク (Fork)**:
    1.  このプロジェクトのGitHubリポジトリページを開きます。
    2.  画面右上にある「Fork」ボタンをクリックします。これにより、あなたのGitHubアカウントにこのリポジトリのコピーが作成されます。自分専用の場所にコピーを作るイメージです。これで、自由に編集や変更を加えても元のプロジェクトには影響しません。
*   **リポジトリのクローン (Clone)**:
    1.  フォークして作成された、あなた自身のリポジトリページを開きます。
    2.  緑色の「Code」ボタンをクリックします。
    3.  表示されたURL（HTTPSまたはSSH）をコピーします。
    4.  お使いのコンピュータのターミナル（コマンドプロンプトやGit Bashなど）を開きます。
    5.  プロジェクトを保存したいディレクトリに移動し、以下のコマンドを実行します。
        ```bash
        git clone <コピーしたURL>
        ```
        例: `git clone https://github.com/your-username/space-invaders-webapp.git`
    6.  `space-invaders-webapp` という名前のフォルダが作成され、その中にプロジェクトファイルがダウンロードされます。
        ```bash
        cd space-invaders-webapp
        ```

### 2. ZIPファイルとしてダウンロードする

Gitに慣れていない場合や、手軽にファイル一式を入手したい場合は、ZIPファイルとしてダウンロードできます。

1.  このプロジェクトのGitHubリポジトリページを開きます。
2.  緑色の「Code」ボタンをクリックします。
3.  「Download ZIP」を選択します。
4.  ダウンロードされたZIPファイルを好きな場所に解凍（展開）します。これでプロジェクトファイル一式が手に入ります。

## セットアップと実行方法

1.  **プロジェクトを準備する**:
    *   もしGitがインストールされていれば、リポジトリをクローンします。
        ```bash
        git clone <repository-url>
        cd space-invaders-webapp
        ```
    *   Gitがない場合は、プロジェクトのZIPファイルをダウンロードして解凍します。

2.  **Python環境の準備とライブラリのインストール**:
    *   コンピュータにPythonがインストールされていることを確認してください。
    *   プロジェクトフォルダ内でターミナル（コマンドプロンプト）を開き、以下のコマンドを実行して必要なライブラリ（Flaskなど）をインストールします。
        ```bash
        pip install -r requirements.txt
        ```

3.  **ゲームの起動**:
    *   ターミナルで以下のコマンドを実行します。
        ```bash
        python app.py
        ```
    *   ターミナルに `* Running on http://127.0.0.1:5000/` のようなメッセージが表示されたら成功です。

4.  **ゲームをプレイ**:
    *   Webブラウザ（Google Chrome, Firefoxなど）を開き、アドレスバーに `http://127.0.0.1:5000/game` と入力してアクセスします。
    *   (もし `index.html` から始めたい場合は `http://127.0.0.1:5000/` にアクセスしてください)

## ゲームの操作方法

*   **移動**: 左右の矢印キー (← →) でコンちゃんを移動します。
*   **弾の発射**: スペースキーで火を発射します。
*   **一時停止/再開**: Enterキーでゲームを一時停止したり再開したりできます。
*   **ゲームの目的**: 画面上部から迫ってくる敵（インベーダー）をすべて撃破しましょう。敵の攻撃や体当たりを避けてください。

## 講座での活用：ゲームを改造してみよう！

このプロジェクトは、皆さんが実際にコードを触って改造することで、より深くWeb開発を学べるように設計されています。

### 改造のヒント (`static/js/game.js` を中心に)

*   **難易度調整**:
    *   プレイヤーの初期ライフ数 (`playerLives` 変数) を変更する。
    *   プレイヤーの移動速度 (`Player` クラス内の `this.speed`) を変更する。
    *   敵の移動速度 (`Enemy` クラス内の `this.speed` や `enemyMoveDelay` 変数) を変更する。
    *   弾の発射間隔 (`playerFireRate` や `enemyFireRate` 変数) を調整する。
*   **新しい機能の追加**:
    *   **新しい敵キャラクター**: 異なる動きや攻撃パターンを持つ敵を追加してみましょう。`Enemy`クラスを継承して新しい敵クラスを作ると良いでしょう。

    *   **背景やキャラクターの変更**: `static/assets/sprites` 内の画像ファイルを差し替えたり、`static/css/style.css` で背景デザインを変更してみましょう。
*   **コードの理解を深める**:
    *   `console.log()` を使って、変数の値や関数の実行順序を確認してみましょう。
    *   特定の処理（例：衝突判定）がどのように行われているか、コードを一行ずつ追ってみましょう。

## オンライン公開の一般的な手順 (PaaSを利用する場合)

このFlaskアプリケーションをオンラインで公開するには、Azure App Service、Google App Engine、PythonAnywhereなどのPaaS (Platform as a Service) を利用するのが一般的です。PaaSを利用すると、サーバーのインフラ管理をサービスプロバイダーに任せることができ、アプリケーションのデプロイと実行に集中できます。

以下では、主要なPaaSの一つである **Azure App Service** を利用したデプロイ手順の概要を説明します。

### Azure App Serviceを利用する場合

1.  **Azureアカウントの準備とAzure CLIのインストール**:
    *   [Azure Portal](https://portal.azure.com/) でアカウントを作成またはサインインします。
    *   **学生向け特典**: 学生の方は、[Azure for Students](https://azure.microsoft.com/ja-jp/free/students/) に登録することで、クレジットカードなしで100ドルのAzureクレジットや無料サービスを利用できる場合があります。ぜひ確認してみてください。
    *   [Azure CLI](https://docs.microsoft.com/ja-jp/cli/azure/install-azure-cli) をインストールし、ログインします。
        ```bash
        az login
        ```

2.  **プロジェクトの準備**:
    *   **`requirements.txt`**: `gunicorn` が含まれていることを確認します。
    *   **起動コマンドの設定**: Azure App Serviceでは、デプロイ時に起動コマンドを指定できます。一般的には `gunicorn --bind=0.0.0.0 --timeout 600 app:app` のようなコマンドになります。

3.  **Azure App Serviceの作成とデプロイ**:
    *   **リソースグループの作成 (まだない場合)**:
        ```bash
        az group create --name <resource-group-name> --location "Japan East"
        ```
    *   **App Serviceプランの作成 (まだない場合)**:
        ```bash
        az appservice plan create --name <app-service-plan-name> --resource-group <resource-group-name> --sku B1 --is-linux
        ```
        (SKUは必要に応じて変更してください。B1は基本的なものです)
    *   **Webアプリの作成とデプロイ (Zipデプロイの場合)**:
        プロジェクトのファイルをZIP圧縮します (例: `source.zip`)。
        ```bash
        az webapp create --resource-group <resource-group-name> --plan <app-service-plan-name> --name <your-app-name> --runtime "PYTHON|3.9" --deployment-source-zip <path-to-your-source.zip>
        ```
        `<your-app-name>` はグローバルにユニークな名前である必要があります。
        Pythonのバージョンはプロジェクトに合わせて調整してください。
    *   **起動コマンドの設定 (ポータルまたはCLIで)**:
        Azure Portalの「構成」>「一般設定」でスタートアップコマンドを設定するか、CLIで設定します。
        ```bash
        az webapp config set --resource-group <resource-group-name> --name <your-app-name> --startup-file "gunicorn --bind=0.0.0.0 --timeout 600 app:app"
        ```
    *   **Gitデプロイ**: Azure App ServiceはGitリポジトリからのデプロイもサポートしています。詳細はAzureのドキュメントを参照してください。

4.  **アプリケーションの確認**:
    *   デプロイが完了したら、Azure PortalでWebアプリの「概要」ページに表示されているURLを確認し、ブラウザでアクセスします。

### HTTPSとSSL/TLS証明書について

### なぜブラウザはHTTP接続に対して「保護されていない通信」と警告されるのか？

Webブラウザ（Google Chrome, Firefox, Safariなど）がHTTP (HyperText Transfer Protocol) で提供されるウェブサイトに対して「保護されていない通信」や「安全ではありません」といった警告を表示するのは、主に以下の理由です。(弊学の場合有線LANに接続したときに警告がでているあれだね。)

*   **データの盗聴リスク**: HTTP通信は暗号化されていません。つまり、送信されるデータ（例えば、フォームに入力した個人情報、パスワード、クレジットカード番号など）が平文のままネットワーク上を流れます。悪意のある第三者がネットワーク経路上でこれらのデータを盗聴される可能性があります。
*   **データの改ざんリスク**: HTTP通信では、データが途中で改ざんされても検知する仕組みがありません。攻撃者によってウェブサイトのコンテンツが書き換えられたり、不正なスクリプトが挿入されたりする可能性があります。
*   **なりすましリスク**: 通信相手のサーバーが本当に正しいサーバーであるかを検証する仕組みがHTTPにはありません。そのため、偽のウェブサイトに誘導され、情報を騙し取られるフィッシング詐欺などのリスクがあります。

これらのリスクからユーザーを保護するため、ブラウザはHTTPS (HTTP Secure) の利用を強く推奨しており、HTTPサイトに対して警告を表示するようになりました。HTTPSはSSL/TLSプロトコルを用いて通信を暗号化し、データの盗聴、改ざん、なりすましを防ぎます。

### SSL/TLS証明書とは？

SSL/TLS証明書（一般的にSSL証明書と呼ばれます）は、ウェブサイトの身元を証明し、ブラウザとウェブサーバー間の通信を暗号化するための電子的な証明書です。主な役割は以下の通りです。

1.  **通信の暗号化**: SSL/TLS証明書に含まれる公開鍵と、サーバーが持つ秘密鍵を使って、送受信されるデータを暗号化します。これにより、第三者によるデータの盗聴を防ぎます。
2.  **ウェブサイトの身元保証**: 信頼された第三者機関である認証局（CA: Certificate Authority）が、ウェブサイトのドメイン所有者の実在性を確認した上で証明書を発行します。これにより、ユーザーはアクセスしているウェブサイトが本物であることを確認できます。
3.  **データの完全性保護**: 通信内容が途中で改ざんされていないことを保証します。

SSL/TLS証明書には、ドメイン名、発行者の情報、有効期限、サーバーの公開鍵などが含まれています。ブラウザはウェブサイトにアクセスする際にこの証明書を検証し、問題がなければアドレスバーに鍵マークなどを表示して安全な接続であることをユーザーに伝えます。

### HTTPSの一般的な取り扱いと証明書の取得方法

HTTPSを導入するには、SSL/TLS証明書を取得し、ウェブサーバーに設定する必要があります。以下に、主な環境ごとの一般的な対応方法と証明書の取得方法を説明します。

#### 1. ローカル開発環境

ローカル開発環境（自分のPC上での開発）では、本番環境ほど厳密なHTTPS設定は必須ではありませんが、HTTPS特有の挙動を確認したい場合や、より本番に近い環境でテストしたい場合に設定することがあります。

*   **方法**: 自己署名証明書（オレオレ証明書）を作成して利用するのが一般的です。
    *   **作成ツール**:
        *   `OpenSSL`: コマンドラインツールで証明書と秘密鍵を生成できます。
        *   `mkcert`: より簡単にローカル開発用の信頼された証明書を作成できるツールです。`mkcert`で作成した証明書は、ローカルマシンのトラストストアに自動で登録されるため、ブラウザの警告なしにHTTPSを利用できます。
    *   **Flaskでの利用例 (`app.py`)**:
        ```python
        if __name__ == '__main__':
            # app.run(host='0.0.0.0', port=5000, debug=True) # HTTPの場合
            app.run(host='0.0.0.0', port=5000, debug=True, ssl_context=('cert.pem', 'key.pem')) # HTTPSの場合
        ```
        ここで、`cert.pem` は証明書ファイル、`key.pem` は秘密鍵ファイルです。これらのファイルは事前に生成しておく必要があります。
*   **注意点**: 自己署名証明書は信頼された認証局によって発行されたものではないため、ブラウザは警告を表示します（`mkcert`でローカルCAを信頼させた場合を除く）。開発目的でのみ使用し、本番環境では絶対に使用しないでください。

#### 2. PaaS環境 (Heroku, Azure App Serviceなど)

多くのPaaSプロバイダーは、HTTPSの導入を容易にする機能を提供しています。

*   **Azure App Service**:
    *   デフォルトで `*.azurewebsites.net` ドメインはHTTPSに対応しています。
    *   カスタムドメインを使用する場合、「App Service Managed Certificates」を利用して無料のSSL/TLS証明書を簡単に設定できます。これも自動更新に対応しています。また、自身で購入した証明書をアップロードすることも可能です。
*   **その他のPaaS**: Google App EngineやPythonAnywhereなどの他のPaaSでも、多くの場合、管理画面から数クリックでSSL/TLS証明書（多くはLet's Encryptベース）を有効にできる機能が提供されています。各プロバイダーのドキュメントを参照してください。

#### 3. 自己ホスティング環境 (VPS、専用サーバーなど)

自身でサーバーを管理している場合、証明書の取得から設定、更新まで自分で行う必要があります。

*   **証明書の取得**:
    *   **Let's Encrypt (無料)**:
        *   最も一般的な選択肢の一つです。無料でSSL/TLS証明書を発行してくれます。
        *   `Certbot` というクライアントツールを使用すると、証明書の取得、ウェブサーバー（Nginx, Apacheなど）への自動設定、証明書の自動更新を簡単に行うことができます。
        *   ドメインの所有権を証明するために、HTTPチャレンジ（一時的に特定のファイルをサーバーに配置）またはDNSチャレンジ（DNSレコードに特定の値を設定）が必要です。

*   **ウェブサーバーの設定**:
    *   取得した証明書（証明書ファイル、中間証明書ファイル、秘密鍵ファイル）をウェブサーバー（Nginx, Apacheなど）に設定します。
    *   通常、ポート443でHTTPS接続を待ち受けるように設定し、HTTP (ポート80) へのアクセスはHTTPSへリダイレクトするように設定することが推奨されます。

**重要な注意点**:
*   **秘密鍵の保護**: 秘密鍵は絶対に漏洩させてはいけません。サーバー上で厳重に管理してください。
*   **証明書の更新**: SSL/TLS証明書には有効期限があります（Let's Encryptは90日）。期限切れになるとブラウザはエラーを表示するため、自動更新の仕組みを導入するか、手動で確実に更新する必要があります。Let's Encrypt + Certbotの組み合わせでは自動更新が設定されるのが一般的です。

---

## 使用アセットについて

このゲームで使用している一部の画像（プレイヤーキャラクター「コンちゃん」など）は、東京電機大学の3D班の部員が作成した「コン部アセット」を使用させていただいています。これらのアセットは部の人間なら無料で使える神アセットなのでみんなも使え👊！特にゲーム班の方々👀

---
## ライセンス

このプログラムは、教育目的および非商用利用に限り、自由に改変して使用することができます。ただし、再配布は面倒事は嫌なのでやめてください。このプログラムが原因で発生したいかなる損害も(endresserror)は責任を負いかねます。

---